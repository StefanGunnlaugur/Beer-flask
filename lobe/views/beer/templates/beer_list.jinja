{% extends "__base.jinja" %}

{% block body %}
    <style type="text/css">   
        .list-group-mine .list-group-item {
            background-color:{{config.COLORS.lineColor}};
        }
        .list-group-mine .list-group-item:hover {
            background-color: {{config.COLORS.warning}};
        }
        .sort-icon{
            color: {{config.COLORS.warning}};
        }
        .sort-icon:hover {
            color: {{config.COLORS.warningDark}};
        }

        #search {
            width:90%;
        }

        .searchicon {
            color:#5CB85C;
        }

        .items-collection{
            margin:20px 0 0 0;
        }
        .items-collection label.btn-default.active{
            background-color:#007ba7;
            color:#FFF;
        }
        .items-collection label.btn-default{
            width:90%;
            border:1px solid #305891;
            margin:5px; 
            border-radius: 17px;
            color: #305891;
        }
        .items-collection label .itemcontent{
            width:100%;
        }
        .items-collection .btn-group{
            width:90%
        }
    </style>

    <div class="container">
        <div class='col-12 mb-4'>
            <h1 class='font-weight-bold row'>Allir bjórar</h1>
            <span class="row">Fjöldi: {{beer_list | length}}</span>
        </div>
        <input type="text" id="beerFilterInput" onkeyup="filterFunction()" placeholder="Leitaðu að bjór">
        <div class="row">
            <div class="mb-3 row" style="color: #303030; padding-left: 8px;" data-toggle="collapse" data-target="#collapse-users" aria-expanded="false" aria-controls="collapse-users" style="cursor: pointer;">
                <span class="py-2" style="color: {{config.COLORS.warning}}; cursor: pointer;"><i class="fas fa-plus mr-2" aria-hidden="true"></i> Leitarsíur</span>
            </div>
        </div>
        <div class="wrapper row">
            
            <div class="row mb-3 col" id="collapse-users">
                <div class="row col">
                    <div class="dropdown">
                        <button class="btn btn-secondary dropdown-toggle" type="button" id="dropdownMenuButton" data-toggle="dropdown" aria-haspopup="true" aria-expanded="false">
                            Raða eftir
                        </button>
                        <div class="dropdown-menu" aria-labelledby="dropdownMenuButton">
                            <div class="dropdown-item btn-group">
                                <a href="{{url}}?sort_by=name&order=asc" class="btn btn-light w-50 text-left">Stafrófsröð(A-Ö)</a>
                                <a href="{{url}}?sort_by=name&order=dsc" class="btn btn-light w-50 text-left">Stafrófsröð(Ö-A)</a>
                            </div>
                            <div class="dropdown-item btn-group">
                                <a href="{{url}}?sort_by=alcohol&order=dsc" class="btn btn-light w-50 text-left">Áfengismagn(Hátt-Lágt)</a>
                                <a href="{{url}}?sort_by=alcohol&order=asc" class="btn btn-light w-50 text-left">Áfengismagn(Lágt-Hátt)</a>
                            </div>
                           <div class="dropdown-item btn-group">
                                <a href="{{url}}?sort_by=price&order=dsc" class="btn btn-light w-50 text-left">Verð(Hátt-Lágt)</a>
                                <a href="{{url}}?sort_by=price&order=asc" class="btn btn-light w-50 text-left">Verð(Lágt-Hátt)</a>
                            </div>
                            <div class="dropdown-item btn-group">
                                <a href="{{url}}?sort_by=volume&order=dsc" class="btn btn-light w-50 text-left">Magn(Hátt-Lágt)</a>
                                <a href="{{url}}?sort_by=volume&order=asc" class="btn btn-light w-50 text-left">Magn(Lágt-Hátt)</a>
                            </div>
                            <div class="dropdown-item btn-group">
                                <a href="{{url}}?sort_by=rating&order=dsc" class="btn btn-light w-50 text-left">Einkunn(Hátt-Lágt)</a>
                                <a href="{{url}}?sort_by=rating&order=asc" class="btn btn-light w-50 text-left">Einkunn(Lágt-Hátt)</a>
                            </div>
                            <div class="dropdown-item btn-group">
                                <a href="{{url}}?sort_by=book_score&order=dsc" class="btn btn-light w-50 text-left">Book stuðull(Hátt-Lágt)</a>
                                <a href="{{url}}?sort_by=book_score&order=asc" class="btn btn-light w-50 text-left">Book stuðull(Lágt-Hátt)</a>
                            </div>
                            <div class="dropdown-item btn-group">
                                <a href="{{url}}?sort_by=economic_score&order=dsc" class="btn btn-light w-50 text-left">Hagkvæmast(Mest-Minnst)</a>
                                <a href="{{url}}?sort_by=economic_score&order=asc" class="btn btn-light w-50 text-left">Hagkvæmast(Minnst-Mest)</a>
                            </div>
                        </div>
                    </div>
                </div>
                <div class="form-group w-100">
                    <div class="items-collection w-100 row btn-group .btn-group-justified">
                        {% for c in categories %}
                            <div class="items col" style="max-width: 20%;">
                                <div class="info-block block-info clearfix">
                                    <div data-toggle="buttons" class="bizmoduleselect">
                                        <label class="btn btn-default">
                                            <div class="itemcontent">
                                                <small class="text-nowrap" style="">{{c}}</small>
                                            </div>
                                        </label>
                                    </div>
                                </div>
                            </div>
                        {% endfor %}
                    </div>
                </div>
            </div>
            
        </div>

        <ul class="list-group-flush list-group-mine" id="beerListUL">
            {% for b in beer_list %}
                <li class="list-group-item mb-1">
                    {{macros.beer_line(b, current_user)}}
                </li>
            {% endfor %}
        </ul>
    </div>
{% endblock %}

{% block scripts %}
    {{super()}}
    <script>
        $(document).ready(function(){
            $('[data-toggle="tooltip"]').tooltip();
        });
        
        function filterFunction() {
            var input, filter, ul, li, a, i, txtValue;
            input = document.getElementById("beerFilterInput");
            filter = input.value.toUpperCase();
            ul = document.getElementById("beerListUL");
            li = ul.getElementsByTagName("li");
            for (i = 0; i < li.length; i++) {
                a = li[i].getElementsByTagName("span")[0]
                //a = li[i].getElementsByTagName("a")[1];
                //a = a.getElementsByTagName("span")[0];
                txtValue = a.textContent || a.innerText;
                if (txtValue.toUpperCase().indexOf(filter) > -1) {
                    li[i].style.display = "";
                } else {
                    li[i].style.display = "none";
                }
            }
        }

        $(document).ready(function () {
            $('.collapse')
                .on('shown.bs.collapse', function() {
                    $(this)
                        .parent()
                        .find(".fa-plus")
                        .removeClass("fa-plus")
                        .addClass("fa-minus");
                })
                .on('hidden.bs.collapse', function() {
                    $(this)
                        .parent()
                        .find(".fa-minus")
                        .removeClass("fa-minus")
                        .addClass("fa-plus");
                });
        });


    function likeBeer(beer_id, action){
        var xhr = new XMLHttpRequest();
        xhr.onload = function(e) {
            if(this.readyState === XMLHttpRequest.DONE) {
                if(xhr.status == '200'){
                    var response = JSON.parse(xhr.responseText);
                    if(response['res'] == 'True'){
                         $('#beer-like-heart-' + beer_id).css("color", "red");
                    }else{
                         $('#beer-like-heart-' + beer_id).css("color", "gray");
                    }
                } else{
                    promptError("Villa koma upp:", xhr.responseText, "");
                }
            }
        }

        let formData = new FormData();
        xhr.open("POST", action, true);
        xhr.send(formData);
    }

    </script>
{% endblock %}